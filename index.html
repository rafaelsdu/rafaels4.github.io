<!DOCTYPE HTML>
<!--
	Massively by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Massively by HTML5 UP</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
		<style>						
			body {
			font-family: 'Open Sans', sans-serif;
			}

			div#layout {
			text-align: center;
			}

			div#container {
			width: 1200px;
			height: 800px;
			margin: auto;
			background-color: #2F4A6D;
			}

			svg {
			width: 100%;
			height: 100%;
			}

			.bar {
			fill: #80cbc4;
			}

			.bar_forecast {
			fill: #9FAAAE;
			}

			.bar_source {
			fill: #FED966;
			}

			text {
			font-size: 12px;
			fill: #fff;
			}

			path {
			stroke: gray;
			}

			line {
			stroke: gray;
			}

			line#limit {
			stroke: #FED966;
			stroke-width: 3;
			stroke-dasharray: 3 6;
			}

			.grid path {
			stroke-width: 0;
			}

			.grid .tick line {
			stroke: #9FAAAE;
			stroke-opacity: 0.3;
			}

			text.divergence {
			font-size: 14px;
			fill: #2F4A6D;
			}

			text.value {
			font-size: 14px;
			}

			text.title {
			font-size: 22px;
			font-weight: 600;
			}

			text.label {
			font-size: 14px;
			font-weight: 400;
			}

			text.source {
			font-size: 10px;
			}
			.countries {
				fill: none;
				stroke: #fff;
				stroke-linejoin: round;
			}
			.legendThreshold {
				font-size: 12px;
				font-family: sans-serif;
			}
			.caption {
				fill: #000;
				text-anchor: start;
				font-size: 14px;
			}
			/*      font-weight: bold;*/

			.anchorNode {
				font-family: "Times New Roman";
				font-size: 2px;
			}
			.legendLinear text.label {
				fill: '#fff'
				font-family: "Times New Roman";
				font-size: 2px;
			}

			.legendThreshold text.label {
				fill: '#fff'
				font-family: "Times New Roman";
				font-size: 12px;

			}
		</style>
	</head>
	<body class="is-preload" onload="init1()">

		<!-- Wrapper -->
			<div id="wrapper" class="fade-in">

				<!-- Intro -->
					<div id="intro">
						<h1>Stolen Futures</h1>
						<p>A Look at the Child Trafficking Industry</p>
						<ul class="actions">
							<li><a href="#header" class="button icon solid solo fa-arrow-down scrolly">Continue</a></li>
						</ul>
					</div>

				<!-- Header -->
					<header id="header">
						<a href="index.html" class="logo">Stolen Futures</a>
					</header>

				<!-- Nav -->
					<nav id="nav">
						<ul class="icons" style="margin-left: auto;">
							<li><a href="#" class="icon solid fa-asterisk"><span class="label">Tableau</span></a></li>
							<li><a href="#" class="icon brands fa-github"><span class="label">GitHub</span></a></li>
						</ul>
					</nav>

				<!-- Main -->
					<div id="main">

						<!-- Featured Post -->
							<article class="post featured">
								<header class="major">
									<span class="date">July 30, 2023</span>
									<h2><a href="#">Stolen Futures:<br />
										A Look at the Child Trafficking Industry</a></h2>
									<p>Commercial sexual exploitation of children is the exploitation <br />
										by an adult with respect to a child or an adolescent – female or male – <br />
									under 18 years old.</p>
								</header>
								<p>The commercial sexual exploitation of children constitutes one of the most severe and disturbing forms of human rights violations occurring globally today. Despite the immense scale and gravity of the issue, public awareness and policy action remain dangerously deficient.</p>
								<p>Recent data indicates that an estimated 1.7 million children worldwide currently face exploitation in the sex trade, though limited reporting and data collection means actual totals are likely significantly higher. Vulnerable minors are trafficked and coerced into providing sexual services, facing continuous abuse and trauma with severe short and long-term repercussions.</p>
								<p>Detailed analysis reveals the complex factors enabling the continuation of child sex trafficking on a massive scale. Poverty, lack of education, gender discrimination, and social instability all contribute to the creation of vulnerable populations prone to exploitation. Lax and corrupt law enforcement together with the enormous profits to be made provide little disincentive for local and transnational trafficking networks to halt operations.</p>
								<p>Societal attitudes tacitly accepting the commodification of minors, lack of outrage over the criminal persecution of victims, and an absence of political will to devote resources or attention to the issue all enable ongoing abuse. Stigma and victim-blaming further suppress the voices of those exploited.</p>
								<p>In summary, the persistence of child commercial sexual exploitation stems from a combination of social, economic, legal, and political factors that together engender a culture of apathy, silence, and impunity. Tackling this systemic issue requires a coordinated global response prioritizing public education, legal reform, corporate responsibility, and victim support. Evidence shows that collaboration on prevention and rehabilitation initiatives can slowly change social norms and practices. But without urgent worldwide action informed by comprehensive analysis of all dimensions of the issue, vulnerable children will continue facing unacceptable exploitation with lifelong consequences.</p>
								<p>Here are some graphs pointing out the prevalence worldwide, the types of countries that have major index and a chance to compare to other forms of moder slavery.</p>
								<p>There are more slaves on any given day today than all the slaves combined when slavery was legal.</p>
								<button type="button" onclick="init1()">1</button>
								<button type="button" onclick="init2()">2</button>
								<button type="button" onclick="init()">3</button>
								<div id='layout1'>
									<div id='container1'>
									</div>
								</div>
								<div id='layout2'>
									<div id='container2'>
									</div>
								</div>
								<div id='layout'>
									<div id='container'>
										<svg></svg>
									</div>
								</div>
								
								<script>
									//Scene 1
									async function init1(){
										d3.selectAll("#layout2 > *").remove();
										d3.selectAll("#layout > *").remove();
										d3.selectAll("#layout1 > *").remove();
										
										//Create Structure:
										// Create layout div
										var layout = d3.select("#layout1");
										if(d3.select("svg")._groups[0][0] == null) {
											// Add container div
											var svgContainer = layout.append("div")
											.attr("id", "container1");
										}

										const width = 1200;
										const marginTop = 46;
										const height = 800;

										//Create SVG   
										// The svg
										var svg = svgContainer.append("svg")
										.attr("width", width)
										.attr("height", height)
										.attr("viewBox", [0, 0, width, height])
										.attr("style", "max-width: 100%; height: auto;");

										// Map and projection
										var path = d3.geoPath();
										var projection = d3.geoMercator()
										.scale(200)
										.center([0,20])
										.translate([width / 2, height / 2]);

										// Data and color scale
										//var data = d3.map();
										var colorScale = d3.scaleThreshold()
										.domain([1, 2, 3, 4, 5, 6, 7, 8, 9, 10])
										.range(d3.schemeOrRd[9]);
										
										// Create tooltip
										const tooltip = svgContainer
															.append("div")
															.attr("class", "tooltip")
															.style("opacity", 0);

										// Load CSV data
										d3.csv("assets/domain/Global_Organized_Crime_Index.csv").then(data => {

											// Load GeoJSON  
											d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson").then(geojson => {

											// Merge the data
											geojson.features.forEach(d => {
												const countryData = data.find(f => f.Country_Code === d.id);

												if(countryData) {
													d.properties = countryData; 
												} else {
													d.properties = {Human_trafficking: 0} // Set default to avoid nulls
												}
											});
											console.log("",geojson);

											// Create color scale
											const colorScale = d3.scaleThreshold()
																.domain([1,2,3,4,5,6,7,8,9])
																.range(d3.schemeOranges[9]);

											//Draw map
											svg.append("g")
												.selectAll("path")
												.data(geojson.features)
												.enter()
												.append("path")
												.attr("d", d3.geoPath().projection(projection)) 
												.style("fill", function (d) { return colorScale(d.properties.Human_trafficking || 0);});
												// .on("mouseover", (d) => {
												
												// tooltip.transition()
												// 		.duration(200)
												// 		.style("opacity", 1);
														
												// tooltip.html(d.properties.Country + "<br/>" + 
												// 			d.properties.Human_trafficking)
												// 		.style("left", (d3.event.pageX + 10) + "px") 
												// 		.style("top", (d3.event.pageY - 28) + "px");
												// })
												// .on("mouseout", () => {
												// 	tooltip.transition()
												// 		.duration(500)
												// 		.style("opacity", 0);
												// });

											//Add legend
											const legend = svg.append("g");
											legend.selectAll("rect")
											.data(colorScale.range())
											.enter()
											.append("rect")
												.attr("x", (d,i) => i*45)
												.attr("y", -20)
												.attr("width", 40)
												.attr("height", 20)
												.style("fill", d => d)
												.attr("transform", "translate(500,700)");
											
											//Add legend labels
											legend.selectAll("text")
											.data(colorScale.domain())
											.enter()
											.append("text")
												.attr("x", (d,i) => i * 45 + 20)
												.attr("y", -5)
												.style("text-anchor", "middle")
												.style("font-weight", "bold") 
												.style("fill", "black") 
												.text(d => d)
												.attr("transform", "translate(500,700)");

											legend.call(d3.axisBottom(colorScale)
															.tickSize(13)
															.tickFormat(d3.format(".0f"))
															.tickValues(colorScale.domain()))
													.attr("transform", "translate(0,10)");  
											

											
											svg.append("text")
												.attr("x", width / 2)
												.attr("y", 30)
												.style("text-anchor", "middle")
												.style("font-weight", "bold") 
												.style("fill", "black") 
												.style("font-size", "30px") 
												.text("Human Trafficking Scores by Country");
											

											

											});

										});
									}
									//Scene 2
									async function init2(){
										d3.selectAll("#layout1 > *").remove();
										d3.selectAll("#layout2 > *").remove();
										d3.selectAll("#layout > *").remove();
										
										//Create Structure:
										// Create layout div
										var layout = d3.select("#layout2");
										if(d3.select("svg")._groups[0][0] == null) {
											// Add container div
											var svgContainer = layout.append("div")
											.attr("id", "container2");
										}

										const width = 1200;
										const margin = 100;
										const height = 800;

										// Set dimensions 
										const radius = (Math.min(width, height) / 2) - margin;

										// Create SVG
										const svg = svgContainer
													.append("svg")
													.attr("width", width) 
													.attr("height", height);
										
										const title = svg.append("g")
														.attr("transform", "translate(50,20)")

										title.append("text")
												.attr("x", width / 2)
												.attr("y", 30)
												.style("text-anchor", "middle")
												.style("font-weight", "bold") 
												.style("fill", "black") 
												.style("font-size", "30px") 
											.text("Forced Commercial Sexual Exploitation by Income Group")
										// Load data
										d3.csv("assets/domain/ILO_FCSE_IncomeGrouping.csv").then(data => {
										
										// Create color scale
										const color = d3.scaleOrdinal()
														.domain(data.map(d => d.INCOME_GROUP))
														.range(['#4daf4a','#377eb8','#ff7f00','#984ea3'])

										// Calculate pie angles
										const pie = d3.pie()
														.value(d => d.FCSE)
														.sort(null);
										
										const arcs = pie(data);
										
										// Draw pie slices  
										svg.selectAll("path")
											.data(arcs)
											.enter()
											.append("path")
											.attr("d", d3.arc()
															.innerRadius(radius * 0.5)
															.outerRadius(radius))
											.attr("fill", d => color(d.data.INCOME_GROUP))
											.attr("stroke", "white")
											.attr("stroke-width", 1) 
											.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");
											
										// Add text labels
										const labelArc = d3.arc()
															.innerRadius(radius * 0.80)
															.outerRadius(radius * 0.80); 

										svg.selectAll("text")
											.data(arcs)
											.enter()
											.append("text")
											.attr("transform", d => {
												const [x, y] = labelArc.centroid(d); 
												return "translate(" + (x + width/2) + "," + (y + height/2) + ")";
											}) 
											.style("text-anchor", "middle")
											.text(d => d.data.INCOME_GROUP);
											
										});
										


										
									}
									//Scene 3
									async function init(){
										d3.selectAll("#layout1 > *").remove();
										d3.selectAll("#layout2 > *").remove();
										//d3.selectAll("#layout > *").remove();
										
										var dataset = await d3.csv("assets/domain/ILO_Slavery_02-28.csv")
										var current_data = dataset.filter(function(d) {
											if(d["Year"] < 2023){
												return d;
											}
										})
										
										var forecast_data = dataset.filter(function(d) {
											if(d["Year"] > 2022){
												return d;
											}
										})
										//Dropdown: List of columns for dropdown
										// var allGroup = d3.map(dataset, function(d){return(d.name)}).keys()
										
										//Create Structure:
										// Create layout div
										var layout = d3.select("#layout");
										if(d3.select("svg")._groups[0][0] == null) {
											// Append select element  
											var select = layout.append("select")
											.attr("id", "selectButton")
											.on("change", init);

											// Add select options  
											select.selectAll("option")
											.data(["Total_Slavery", "Total_Slavery_Child", "Forced_Marriage_Child", "Forced_Sex_Explotation_Child"])
											.enter()
											.append("option")
												.attr("value", d => d) 
												.text(d => d.replaceAll("_", " ")); 

											// Set default selected option
											select.property("value", "Forced_Sex_Explotation_Child");

											// Add container div
											var svgContainer = layout.append("div")
											.attr("id", "container");
										}


										var headers = dataset.columns;
										var z = headers.splice(0,1);
										var z = headers.splice(4,1);
										d3.selectAll("#container > *").remove();

										const svg = d3.select("#container").append('svg');
										
										var selectButton = d3.select('#selectButton').node(); 
										var selectValue = selectButton.options[selectButton.selectedIndex].value;
										//console.log("",selectButton,selectValue);
										
										const margin = 80;
										const width = 1200 - 2 * margin;
										const height = 800 - 2 * margin;

										const chart = svg.append('g')
										.attr('transform', `translate(${margin}, ${margin})`);

										const xScale = d3.scaleBand()
													.domain(dataset.map(function (d) {return d.Year;}))
													.range([0, width])
													.padding(0.2);
										const yScale = d3.scaleLinear()
													.domain([0, d3.max(dataset, function (d) {
														//console.log("selectValue",d,selectValue)
														return +d[selectValue];

													})])
													.range([height, 0]);

										const makeYLines = () => d3.axisLeft()
										.scale(yScale)

										chart.append('g')
										.attr('transform', `translate(0, ${height})`)
										.call(d3.axisBottom(xScale));

										chart.append('g')
										.call(d3.axisLeft(yScale));

										chart.append('g')
										.attr('class', 'grid')
										.call(makeYLines()
											.tickSize(-width, 0, 0)
											.tickFormat('')
										)

										const barGroups = chart.selectAll()
										.data(dataset)
										.enter()
										.append('g');

										barGroups
										.append('rect')
										.attr("class", function(d) {
											if(d.Annotation == "Forecasted") {
												return "bar_forecast";
											} else if(d.Annotation == "ILO Source") {
												return "bar_source";
											} else {
												return "bar";
											}
										})
										.attr("fill-opacity", function(d) {
											if(d.Annotation == "Forecasted") {
												return "0.3";
											} else {
												return "1";
											}
										})
										.attr('x', (g) => xScale(g.Year))
										.attr('y', (g) => yScale(g[selectValue]))
										.attr('height', function (g) { 
											//console.log("", g);
											return height - yScale(g[selectValue]);})
										.attr('width', xScale.bandwidth())
										//.transition().delay(2000)
										.on('mouseenter', function (actual, i) {
											//console.log("", actual, i);
											d3.selectAll('.value')
											.attr('opacity', 0)

											d3.select(this)
											.transition()
											.duration(500)
											.attr('opacity', 0.6)
											.attr('x', (a) => xScale(a.Year) - 5)
											.attr('width', xScale.bandwidth() + 10)

											const y = yScale(i[selectValue])

											line = chart.append('line')
											.attr('id', 'limit')
											.attr('x1', 0)
											.attr('y1', y)
											.attr('x2', width)
											.attr('y2', y)

											barGroups.append('text')
											.attr('class', 'divergence')
											.attr('x', (a) => xScale(a.Year) + xScale.bandwidth() / 2)
											.attr('y', (a) => yScale(a[selectValue]) + 30)
											.attr('fill', 'white')
											.attr('text-anchor', 'middle')
											.text((a, idx) => {
												const divergence = (a[selectValue] - i[selectValue]).toFixed(1)
												
												let text = ''
												if (divergence > 0) text += '+'
												text += `${divergence}`

												return idx !== i ? text : '';
											})

										})
										.on('mouseleave', function () {
											// Tooltip
											// .style("opacity", 0)
											// d3.select(this)
											// .style("stroke", "none")
											// .style("opacity", 0.8)

											d3.selectAll('.value')
											.attr('opacity', 1)

											d3.select(this)
											.transition()
											.duration(300)
											.attr('opacity', 1)
											.attr('x', (a) => xScale(a.Year))
											.attr('width', xScale.bandwidth())

											chart.selectAll('#limit').remove()
											chart.selectAll('.divergence').remove()
										})
										// .on("mouseover", mouseover)
    									// .on("mousemove", mousemove)

										barGroups 
										.append('text')
										.attr('class', 'value')
										.attr('x', (a) => xScale(a.Year) + xScale.bandwidth() / 2)
										.attr('y', (a) => yScale(a[selectValue]) + 30)
										.attr('text-anchor', 'middle')
										.text((a) => `${a[selectValue]}`)
										
										svg
										.append('text')
										.attr('class', 'label')
										.attr('x', -(height / 2) - margin)
										.attr('y', margin / 2.4)
										.attr('transform', 'rotate(-90)')
										.attr('text-anchor', 'middle')
										.text('Millions')

										svg.append('text')
										.attr('class', 'label')
										.attr('x', width / 2 + margin)
										.attr('y', height + margin * 1.7)
										.attr('text-anchor', 'middle')
										.text('Years')

										svg.append('text')
										.attr('class', 'title')
										.attr('x', width / 2 + margin)
										.attr('y', 40)
										.attr('text-anchor', 'middle')
										.text(getTitle(selectValue))

										svg.append('text')
										.attr('class', 'source')
										.attr('x', width - margin / 2)
										.attr('y', height + margin * 1.7)
										.attr('text-anchor', 'start')
										.text('Source: www.ilo.org, 2023')
										
										function getTitle(selectValue) {
											switch(selectValue){
												case "Total_Slavery":
													return "World Total Slavery (millions)";
												case "Total_Slavery_Child": 
													return "World Total Children in Slavery (millions)";
												case "Forced_Marriage_Child": 
													return "World Total Children in Forced Marriage (millions)";
												case "Forced_Sex_Explotation_Child": 
													return "World Total Children in Forced Commercial Sexual Exploitation (millions)";
											}
										}

										function update(selectedGroup) {
											var dataFilter = dataset.filter(function(d){return d.name==selectedGroup})

										}

										//Annotations
										const type = d3.annotationCustomType(
											d3.annotationCalloutCurve, 
											{"className":"custom",
											"connector":{"type":"curve",
											"end":"arrow"},
											"note":{"lineType":"horizontal"}})
										
										const annotations = [{
										note: {
											label: "From linear to non linear.",
											title: "Increased Growth"
										},
										//can use x, y directly instead of data
										// x: 485,
										// y: 600,
										data: { x: "2012", y: "2012"},
										dy: -137,
										dx: -162,
											connector: {
											curve: d3.curveBasis,
											points: 1
											}
										},{
										note: {
											label: "Based on non linear trends.",
											title: "Forecast"
										},
										//can use x, y directly instead of data
										// x: 865,
										// y: 370,
										data: { x: "2022", y: "2022"},
										dy: -100,
										dx: -100,
											connector: {
											curve: d3.curveBasis,
											points: 1
											}
										},{
										note: {
											label: "Yellow bars are official ILO estimates.",
											title: "ILO Estimate"
										},
										//can use x, y directly instead of data
										// x: 635,
										// y: 530,
										data: { x: "2016", y: "2016"},
										dy: -150,
										dx: -100,
											connector: {
											curve: d3.curveBasis,
											points: 1
											}
										}].map(function(d){ d.color = "#d9534f"; return d})


										const makeAnnotations = d3.annotation()
										//also can set and override in the note.padding property
										//of the annotation object
										.accessors({
											x: function x(d){return xScale(d.x)+margin;},
											y: function y(i){return yScale(dataset.filter(function(d){return d.Year == i.y })[0][selectValue])+margin;}
										})
										.notePadding(6)
										.type(type)
										.annotations(annotations)

										svg.append("g")
										.attr("class", "annotation-group")
										.call(makeAnnotations)

									
									}
									async function updateBar(){
										var dataset = await d3.csv("assets/domain/ILO_Slavery_02-28.csv")
										const svg = d3.select('svg');
										const svgContainer = d3.select('#container');
										//Update all rects
										svg.selectAll("rect")
											.data(dataset)
											.transition() // <---- Here is the transition
											.duration(2000) // 2 seconds
											.attr("y", function(d) {
											return h - yScale(d);
											})
											.attr("height", function(d) {
											return yScale(d);
											});
									}
								</script>
							</article>
							<!-- <footer>
								<div class="pagination">
									<a href="#" class="previous">Prev</a>
									<a href="#" class="page active">1</a>
									<a href="#" class="page">2</a>
									<a href="#" class="page">3</a>
									<a href="#" class="page">4</a>
									<a href="#" class="page">5</a>
									<a href="#" class="next">Next</a>
								</div>
							</footer> -->

					</div>


				<!-- Copyright -->
					<div id="copyright">
						<ul><li>Design: <a href="https://html5up.net">HTML5 UP</a></li></ul>
					</div>

			</div>

		<!-- Graph Scripts -->
      		<script src="https://d3js.org/d3.v7.js"></script>
			<script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
			<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
			<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
			<script src="https://unpkg.com/topojson@3.0.2/dist/topojson.js"></script> 
			<!--<script src="https://cdn.jsdelivr.net/npm/d3-array@3/+esm"></script> -->
			<!-- <script src="https://github.com/d3/d3-queue/blob/master/index.js"></script> -->


		<!-- HTML Template Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>


	</body>
</html>